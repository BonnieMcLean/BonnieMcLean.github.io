---
title: "Homework exercise 4"
output: html_notebook
---

# Instructions

* Modify the `barnamn` tibble to add two new columns. The first new column should indicate whether the name *begins* in a vowel or a consonant. The second new column should indicate whether the name *ends* in a vowel or a consonant. **Hint**: You will need to use `str_sub` from the `string_r` package, which we learnt about in Lecture 4.  
* Then use `grid_facet` with `ggplot` to plot the total number of names beginning with vowels/consonants, versus ending with vowels/consonants over the years
* Use colour to plot the data for male and female names separately on each of these 4 subplots. 

# Feedback

* Everybody did really well at this, the main little trick was to remember also the str_to_lower()/str_to_upper() functions for changing the case of the letters in the names.
* As some of you noticed, in the consonant finals, the men are always on top, while in the vowel finals, the women are always on top. In the initials, it swaps around, so the difference between men and women actually ends up cancelling out.
* What this means is that there is a bias for mens names to end in consonants, and womens names to end in vowels, but no such bias for how the names start (both men and womens names start equally often in vowels and consonants)
* The graph I had you make is actually not the best for visualising this; you have to think about it a lot before you can see the relationships!
* So, I figured out a better way to visualise it, and for that we actually require the function `pivot_longer()` which we just learnt last week (so you didn't actually know about this function yet when you did this assignment)
* I've included this better visualisation, where you can see the effect more clearly, after the answer to the homework
* This is a good lesson in how a well-chosen visualisation can strengthen the message of your research!

# Solution to homework

```{r load required packages}
library(barnnamn)
library(stringr)
library(tidyverse)
```


```{r plot initials and finals, message=FALSE,warning=FALSE}
vowels <- c('a','å','ä','i','y','u','e','o','ö')

barnnamn %>%
  # 1. Get the first letter column
  mutate(FirstLetter=str_sub(name,1,1))%>%
  # 2. Get the last letter column
  mutate(LastLetter=str_sub(name,-1,-1))%>%
  
  # 3. Work out which names are vowel versus consonant initial versus final - don't forget to make the first letters lowercase!
  mutate(Initial=ifelse(str_to_lower(FirstLetter) %in% vowels,'Vowel Initial','Consonant Initial'))%>%
  mutate(Final=ifelse(LastLetter %in% vowels,'Vowel Final','Consonant Final'))%>%
  
  # 4. Work out the sum of vowel initial/final names across years and sexes
  group_by(year,sex,Initial,Final)%>%
  summarise(total=sum(n))%>%
  
  # 5. plot this with (1) year and total, (2) sex, (3) facet grid
  ggplot(aes(x=year,y=total,colour=sex))+geom_line()+facet_grid(Initial~Final)+theme_minimal()+labs(title="Names in barnnamn")
```

# A better visualisation

To get the data in the right form for this plot required a little data wrangling. First, I made the columns for the Initials and Finals, like in the previous graph, but after that I used `pivot_longer()` to turn those columns into their own column--Position, like this:

```{r}
barnnamn %>% 
  mutate(Initial=if_else(str_sub(str_to_lower(name),1,1) %in% vowels,"vowel","consonant")) %>% 
  mutate(Final=if_else(str_sub(name,-1,-1) %in% vowels,"vowel","consonant"))%>%
  pivot_longer(c(Initial,Final),names_to="Position",values_to="Sound")->long_barn

long_barn
```

For this graph, I just looked at the data as a whole, instead of showing it year by year. I used `face_wrap()` to plot the initials and finals separately, and `geom_col()` with `position="fill"` to show the *proportion* of male and female names, instead of just the raw numbers. This is a better comparison because there are slightly more male names overall than female names. This figure makes it more obvious that there is an effect of sex, where final sounds in names are more likely to be vowels for females, and consonants for males, in the swedish baby names; the comparison with the initials as a separate graph also shows that there is no such effect there.

```{r}
long_barn%>%
  group_by(sex,Position,Sound)%>%
  mutate(total=sum(n))%>%
  ggplot(aes(x=Sound,y=total,fill=sex))+geom_col(position="fill")+theme_minimal()+facet_wrap(~Position)+labs(y="Proportion of names",title = "Sound symbolism in finals of names in barnnamn")
```

If you're interested in why this might be, look up papers on *sound symbolism* and *iconicity*. This is actually my own area of research! A good paper to get you started is [here](https://doi.org/10.1177/0963721419850134).
